## Next, we need to trim the sequences from adapters that were used for sequencing so that we are sure to have only genomic sequences and not rests of adapters as nucleotides. 
## We will also quality check the sequences with fastqc and the multiqc. At the end, we will download these files and check them locally
## For this, we create a script, called "trim.sh"
## We also need a file "name.list", which stores the names of the files without "_1.fq.gz" in it
## We also need a new folder, "04.TrimmedData", and within this, a folder called "unpair" for the unpaired data, and a folder called "logs" for the data on 

### nano trim.sh
### chmod +x trim.sh  #this makes the script usable (runable) in Bash
### ls -l trim.sh  #here, you check if can be run
### sbatch --array=1,2 trim.sh  #with this code, you run an array job, where you create multiple subjobs for each file, e.g. 18 for the 18 wood ant samples
### squeue -u $USER  #check if the script runs

## Below is the acutal code which is stored in the script
# 2_trim.sh

#!/bin/bash -l 
#SBATCH -J trim
#SBATCH -o 04.TrimmedData/logs/trim_%j.out       #path to output log file
#SBATCH -e 04.TrimmedData/logs/trim_%j.err       #path to error log file
#SBATCH --account=project_2009316                #project account
#SBATCH -t 4:00:00
#SBATCH -p small
#SBATCH --array=1-18                             #number of samples
#SBATCH --ntasks 4
#SBATCH --mem=8G
#SBATCH --mail-type=BEGIN,END,FAIL

cd /scratch/project_2009316/DutchSamples/X204SC23115958-Z01-F008/

file=$(sed -n "$SLURM_ARRAY_TASK_ID"p name.list)         #before this create a name list file
echo $file

## Load required modules
module load biokit
module load trimmomatic/0.39

## Trim reads
trimmomatic PE -threads 4 -phred33 \
-trimlog 04.TrimmedData/logs/${file}.trim.log \
03.CombinedRawData/$file"_1.fq.gz" 03.CombinedRawData/$file"_2.fq.gz" \
04.TrimmedData/$file"_1.trim.pair.fq.gz" 04.TrimmedData/unpair/$file"_1.trim.unpair.fq.gz" \
04.TrimmedData/$file"_2.trim.pair.fq.gz" 04.TrimmedData/unpair/$file"_2.trim.unpair.fq.gz" \
ILLUMINACLIP:/scratch/project_2009316/Adriana/X204SC23115958-Z01-F001_01/04.TrimmedData/adapters/TruSeq3-PE_and_NebNext.fa:2:30:10:2:keepBothReads LEADING:10 TRAILING:10 SLIDINGWINDOW:4:15 MINLEN:50    

## Quality control
fastqc 04.TrimmedData/$file"_1.trim.pair.fq.gz" -o 04.TrimmedData/FastQC && \
fastqc 04.TrimmedData/$file"_2.trim.pair.fq.gz" -o 04.TrimmedData/FastQC


## DOWNLOAD FROM HPC TO LOCAL COMPUTER     # "." means current working directory on local machine; download while being on local machine
## scp krapfpat@puhti.csc.fi:/scratch/project_2009316/DutchSamples/X204SC23115958-Z01-F008//04.TrimmedData/FastQC/*.html .
