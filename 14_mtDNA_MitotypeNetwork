# Below, we will first call SNPs from the mitochonrial part of the WGS only
# For this, we nwill use again freebayes and need a "regions_mtDNA.txt" file with only the mtDNA region in it for the SNP calling
# We will use sinteractive to create this regions_mtDNA file

sinteractive --account project_2009316 --mem 2000
cd /scratch/project_2009316/refGenome/

#modify regions file so that Freebayes accepts it
cd /scratch/project_2009316/refGenome
awk 'BEGIN{OFS=""} {print $1,":",$2,"-",$3}' Formica_hybrid_v1_wFhyb_Sapis_5e6_data_regions.fa.fai > Formica_hybrid_v1_5e6_data_regions.tmp

#remove regions that require different SNP calling parameters if they are needed: Wolbachia (wFhyb*), and Spiroplasma (Spiroplasma*), as well as Scaffold00, but KEEP mtDNA
#that has unmapped reads (for cutting off SNP calling time since it will not be used anyway in the analyses I can think of)
grep -v -e wFhyb -e Spiroplasma -e Scaffold00 Formica_hybrid_v1_5e6_data_regionswmtDNA.tmp > Formica_hybrid_v1_5e6_data_regions_wmtDNA.txt ; rm Formica_hybrid_v1_5e6_data_regionswmtDNA.tmp
#exit sinteractive

#cd /scratch/project_2009316/DutchSamples/X204SC23115958-Z01-F008/06.VCF

grep -e mtDNA Formica_hybrid_v1_5e6_data_regions_wmtDNA.txt > regions_mtDNA.txt

# Now, we create a new folder called "07.VCF_mtDNA"
cd /scratch/project_2009316/DutchSamples/X204SC23115958-Z01-F008/
mkdir 07.VCF_mtDNA

#Next, we will do the SNP calling. Again, we will use "screen" to create an external screen
screen -S snpcall_mtDNA
module load freebayes # version used in 2023: v1.3.6

cd /scratch/project_2009316/DutchSamples/X204SC23115958-Z01-F008/06.VCF
REF=/scratch/project_2009316/refGenome
RES=/scratch/project_2009316/DutchSamples/X204SC23115958-Z01-F008/07.VCF_mtDNA
BAM=/scratch/project_2009316/DutchSamples/X204SC23115958-Z01-F008/05.BAM/bam_final

freebayes-puhti -time 72 -mem 64 -regions $REF/regions_mtDNA.txt -f $REF/Formica_hybrid_v1_wFhyb_Sapis.fa -L $BAM/all.bam.list -k --genotype-qualities --skip-coverage 15200 --limit-coverage 100 --use-best-n-alleles 3 --pooled-continuous -out $RES/raw/all_samples_mtDNA_raw.vcf
bcftools stats $RES/raw/all_samples_mtDNA_raw.vcf







